#
#
# This Makefile is automatically generated
# from executing the following command-line:
#
# make -f Makefile.gen
#
#

######
#
CC=gcc
CCOMP=$(CC)
#
export ATSCCOMP=$(CC)
#
######

ATS1CC=$(ATSHOME)/bin/atscc
ATSOPT=$(ATSHOME)/bin/atsopt

######

CFLAGS=-g
CFLAGS=-g -O
CFLAGS=-g -O2

######
#
GCFLAG=
#
# GCFLAG=-D_ATS_NGC
# GCFLAG=-D_ATS_GCBDW
# GCFLAG=-D_ATS_GCATS
#
######
#
# Bootstrapping:
#
# [gmpknd] for CBOOTgmp
# [intknd] for CBOOTint
#
C3NSTRINTKND=gmpknd
#C3NSTRINTKND=gmpknd
#C3NSTRINTKND=intknd
#
######
#
DATSCC=-DATS \
C3NSTRINTKND=$(C3NSTRINTKND)
#
######

LIBATS=-lats

######
#
# HX: no [gmp] 
ifeq ($(C3NSTRINTKND),intknd)
LIBGMP=
endif
#
# HX: [gmp] needed
ifeq ($(C3NSTRINTKND),gmpknd)
LIBGMP=-lgmp
endif
#
######

SOURCES := \
#__tok1$

SOURCESsta := $(filter %.sats, $(SOURCES))
SOURCESdyn := $(filter %.dats, $(SOURCES))

######

TARGETS := \
#__tok2$
TARGETS += BUILD/pats_main_dats.c
TARGETS += BUILD/pats_main_none_dats.c

######

OBJECTS := \
#__tok3$

######

all:: tempopt

######
#
# AS-20130407:
# link order matters to GNU ld
# please keep the order '$(LIBATS) $(LIBGMP)'
# as the former depends on the latter
#
tempopt:: $(TARGETS)
tempopt:: $(OBJECTS) ; \
$(ATS1CC) $(CFLAGS) $(GCFLAG) \
-o $@ pats_main.dats $(OBJECTS) $(LIBATS) $(LIBGMP)
#
cleanall:: ; $(RMF) tempopt
#
######
#
libatsopt:: $(TARGETS)
#
libatsopt:: $(OBJECTS) BUILD/pats_main_none_dats.o; $(ARR) libatsopt.a $^
#
######
#
# for building tempopt through CMake
#
BUILD/init: ; cd BUILD; cmake ..; cd ..
BUILD/clean: ; make -C BUILD -f Makefile clean
BUILD/tempopt: ; make -C BUILD -j8 -f Makefile tempopt
#
######
CBOOT:: CBOOTgmp
######
#
CBOOTgmp:: ; $(CPF) pats_*.cats CBOOT
CBOOTgmp:: ; $(CPF) BUILD/pats_*_sats.c CBOOT
CBOOTgmp:: ; $(CPF) BUILD/pats_*_dats.c CBOOT
CBOOTgmp:: ; $(CPF) Makefile_CBOOTgmp CBOOT/Makefile
#
######
#
CBOOTint:: ; $(CPF) pats_*.cats CBOOT
CBOOTint:: ; $(CPF) BUILD/pats_*_sats.c CBOOT
CBOOTint:: ; $(CPF) BUILD/pats_*_dats.c CBOOT
CBOOTint:: ; $(CPF) Makefile_CBOOTint CBOOT/Makefile
#
######

TAGATS:: ; $(RMF) $@
TAGATS:: ; $(ATSOPT) --output-a $@ --taggen -s $(SOURCESsta) -d $(SOURCESdyn)

######
#
#__tok4$
#
BUILD/pats_main_dats.c: \
  pats_main.dats ; $(ATSOPT) $(DATSCC) -o $@ -d $<
#
BUILD/pats_main_none_dats.o: \
BUILD/pats_main_none_dats.c; $(ATSOPT) $(CFLAGS) -o $@ $<
BUILD/pats_main_none_dats.c: \
  pats_main.dats ; $(ATSOPT) $(DATSCC) -DATS PATSOPT_MAIN_NONE -o $@ -d $<
#
######
#
# HX: '-o .depend' means appending instead of overwriting
#
depend::
	$(RMF) .depend
	$(ATSOPT) --output-a .depend --depgen -d pats_main.dats
	$(ATSOPT) --output-a .depend --depgen -s $(SOURCESsta) -d $(SOURCESdyn)
#
-include .depend
#
######

DIR=.
ARR=ar -r
CPF=cp -f
RMF=rm -f
WCL=wc -l

######
#
srclines:: ; $(WCL)   pats_main.dats $(SOURCES)
#
liblines:: ; $(WCL)   ../prelude/*.sats   ../prelude/?ATS/*.?ats   ../libc/?ATS/*.?ats   ../libats/?ATS/*.?ats ../libats/?ATS/SHARE/*.?ats
#
######

clean:: ; $(RMF) $(DIR)/*~
clean:: ; $(RMF) $(DIR)/*_?ats.c
clean:: ; $(RMF) $(DIR)/BUILD/*_?ats.o
clean:: ; $(RMF) $(DIR)/BUILD/*_?ats.c

cleanall:: clean
cleanall:: ; $(RMF) TAGATS

###### end of [Makefile] ######
